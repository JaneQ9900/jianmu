cron: '* 5/* * * * ? *'

event:
  push_event:
    branch: ${branch_name} # dev, master
  tag_event:
    tag: ${branch_name} # tag_name

param:
  branch_name:
    type: string
    value: dev
  git_return:
    type: number
    value: 200

workflow:
  name: 测试流程1
  ref: flow_1
  description: 测试流程1的描述
  Start_1:
    type: start
    targets:
      - Git_v1
  Git_1:
    type: git_0.1
    sources:
      - Start_1
    targets:
      - Build_1
    param:
      git_user: ((git_account_a.user))
      git_pass: ((git_account_a.pass))
      git_key: ((git_key))
      git_repo: https://github/testuser/testproject.git
      branch_name: ${branch_name}
  Build_1:
    type: maven_0.1
    sources:
      - Git_1
    targets:
      - Condition_1
    param:
      cmd: mvn install
  Condition_1:
    type: condition
    sources:
      - Build_1
    expression: ${Build_1.build_status} is True
    cases:
      false: Sms_Notice_0.1
      true: Weixin_Notice_0.1
  Notice_1:
    type: Sms_Notice_0.1
    param:
      text: '"Build error, msg is: " + ${Build_1.build_error_message}'
    sources:
      - Condition_1
    targets:
      - End_1
  Notice_2:
    type: Weixin_Notice_0.1
    param:
      text: ${Build_1.build_info}
    sources:
      - Condition_1
    targets:
      - End_1
  End_1:
    type: end
    sources:
      - Sms_Notice_0.1
      - Weixin_Notice_0.1
