cron: '* 5/* * * * ? *'

param:
  branch_name: master
  git_site: gitee.com

workflow:
  name: CI_Flow
  ref: ci_flow
  description: jianmu-workflow-core CI Flow
  Start:
    type: start
    targets:
      - GitClone
  GitClone:
    type: git_clone:0.4
    sources:
      - Start
    targets:
      - Build
    param:
      commit_branch: ${branch_name}
      remote_url: https://gitee.com/jianmu_dev/jianmu-workflow-core.git
      netrc_machine: ${git_site}
      netrc_username: ((gitee.user))
      netrc_password: ((gitee.pass))
  Build:
    type: maven:11
    sources:
      - GitClone
    targets:
      - Condition
    param:
      cmd: mvn install
  Condition:
    type: condition
    sources:
      - Build
    expression: Git_1["commit_branch"] == "dev"
    cases:
      false: Notice_1
      true: Notice_2
  Notice_1:
    type: sms:0.1
    param:
      text: '"Build error, msg is: " + ${Build_1.build_error_message}'
    sources:
      - Condition
    targets:
      - End
  Notice_2:
    type: weixin:0.1
    param:
      text: ${Build_1.build_info}
    sources:
      - Condition
    targets:
      - End
  End:
    type: end
    sources:
      - Notice_1
      - Notice_2
